!function(){"use strict";!function(e){e.None="none",e.Url="url",e.Blur="blur",e.Brightness="brightness",e.Contrast="contrast",e.DropShadow="drop-shadow",e.Grayscale="grayscale",e.HueRotate="hue-rotate",e.Invert="invert",e.Opacity="opacity",e.Saturate="saturate",e.Sepia="sepia"}(e||(e={}));var e,i,r,t=new Map,o=function(e){var t=document.createElement("canvas");return t.height=e.canvas.height,t.width=e.canvas.width,Object.defineProperty(t,"__skipFilterPatch",{value:!0}),t.getContext("2d")},a=["__skipFilterPatch","__currentPathMirror","canvas","filter","getImageData"],c=["clearRect","drawImage","fill","fillRect","fillText","stroke","strokeRect","strokeText"],l=function(e,n){n.match(/([-a-z]+)(?:\(([\w\d\s.%-]*)\))?/gim).map(function(e){return e.match(/([-a-z]+)(?:\((.*)\))?/i).slice(1,3)}).reduce(function(e,n){var s=n[0],o=n[1];return t.has(s)?t.get(s).apply(void 0,[e].concat((o||"").split(" "))):e},e)},n=function(e){var t=parseFloat(e);return/%\s*?$/i.test(e)&&(t/=100),t},s=function(e){return parseFloat(e)};t.set(e.None,function(e){return e}),t.set(e.Blur,function(e,t){if(void 0===t&&(t="0"),m=s(t),m<=0)return e;for(var o,a,l,d,u,m,y,z=e.canvas,M=z.height,h=z.width,T=e.getImageData(0,0,h,M),n=T.data,S=h-1,F=M-1,c=m+1,A=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1][m],C=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18][m],O=[],_=[],x=[],w=[],k=[],E=[],D=3;D-- >0;){for(var p=0,i=0,r=0;r<M;r++){for(var b=n[p]*c,v=n[p+1]*c,g=n[p+2]*c,j=n[p+3]*c,f=1;f<=m;f++)a=p+((f>S?S:f)<<2),b+=n[a++],v+=n[a++],g+=n[a++],j+=n[a];for(o=0;o<h;o++)O[i]=b,_[i]=v,x[i]=g,w[i]=j,0===r&&(k[o]=((a=o+c)<S?a:S)<<2,E[o]=(a=o-m)>0?a<<2:0),l=p+k[o],d=p+E[o],b+=n[l++]-n[d++],v+=n[l++]-n[d++],g+=n[l++]-n[d++],j+=n[l]-n[d],i++;p+=h<<2}for(o=0;o<h;o++){u=o;for(b=O[u]*c,v=_[u]*c,g=x[u]*c,j=w[u]*c,f=1;f<=m;f++)b+=O[u+=f>F?0:h],v+=_[u],g+=x[u],j+=w[u];for(i=o<<2,r=0;r<M;r++)n[i+3]=y=j*A>>>C,y>0?(y=255/y,n[i]=(b*A>>>C)*y,n[i+1]=(v*A>>>C)*y,n[i+2]=(g*A>>>C)*y):n[i]=n[i+1]=n[i+2]=0,0===o&&(k[r]=((a=r+c)<F?a:F)*h,E[r]=(a=r-m)>0?a*h:0),l=o+k[r],d=o+E[r],b+=O[l]-O[d],v+=_[l]-_[d],g+=x[l]-x[d],j+=w[l]-w[d],i+=h<<2}}return e.putImageData(T,0,0),e}),t.set(e.Brightness,function(e,t){if(void 0===t&&(t="1"),1===(t=n(t)))return e;t<0&&(t=0);for(var i=e.canvas,r=i.height,c=i.width,a=e.getImageData(0,0,c,r),o=a.data,l=o.length,s=0;s<l;s+=4)o[s+0]*=t,o[s+1]*=t,o[s+2]*=t;return e.putImageData(a,0,0),e}),t.set(e.Contrast,function(e,t){if(void 0===t&&(t="1"),1===(t=n(t)))return e;t<0&&(t=0);for(var i=e.canvas,r=i.height,c=i.width,a=e.getImageData(0,0,c,r),o=a.data,l=o.length,s=0;s<l;s+=4)o[s+0]=255*((o[s+0]/255-.5)*t+.5),o[s+1]=255*((o[s+1]/255-.5)*t+.5),o[s+2]=255*((o[s+2]/255-.5)*t+.5);return e.putImageData(a,0,0),e}),t.set(e.DropShadow,function(e,t,n,o,i){a=document.createElement("canvas").getContext("2d"),a.shadowOffsetX=s(t),a.shadowOffsetY=s(n),a.shadowBlur=i?s(o||"0"):0,a.shadowColor=i||o||"transparent",a.drawImage(e.canvas,0,0);var a,r=e.canvas,c=r.width,l=r.height;return e.putImageData(a.getImageData(0,0,c,l),0,0),e}),t.set(e.Grayscale,function(e,t){if(void 0===t&&(t="0"),(t=n(t))<=0)return e;t>1&&(t=1);for(var i,a=e.canvas,c=a.height,l=a.width,r=e.getImageData(0,0,l,c),o=r.data,d=o.length,s=0;s<d;s+=4)i=.2126*o[s]+.7152*o[s+1]+.0722*o[s+2],o[s+0]+=(i-o[s+0])*t,o[s+1]+=(i-o[s+1])*t,o[s+2]+=(i-o[s+2])*t;return e.putImageData(r,0,0),e}),t.set(e.HueRotate,function(e,t){if(void 0===t&&(t="0deg"),_=function(e){var t=parseFloat(e);switch(e.slice(t.toString().length)){case"deg":t/=360;break;case"grad":t/=400;break;case"rad":t/=2*Math.PI}return t}(t),_<=0)return e;var o,a,r,c,l,d,u,h,m,f,p,g,_,w=e.canvas,E=w.height,j=w.width,C=e.getImageData(0,0,j,E),i=C.data,x=(_%1+1)%1*3,O=Math.floor(x),n=x-O,s=1-n;switch(O){case 0:c=s,m=0,f=n,r=n,h=s,a=0,l=0,d=n,u=s;break;case 1:c=0,m=n,f=s,r=s,h=0,a=n,l=n,d=s,u=0;break;case 2:c=n,m=s,f=0,r=0,h=n,a=s,l=s,d=0,u=n}for(o=0,g=0;g<E;++g)for(p=0;p<j;++p){var v=i[0+(o=4*(g*j+p))],b=i[o+1],y=i[o+2];i[o+0]=Math.floor(c*v+m*b+f*y),i[o+1]=Math.floor(r*v+h*b+a*y),i[o+2]=Math.floor(l*v+d*b+u*y)}return e.putImageData(C,0,0),e}),t.set(e.Invert,function(e,t){if(void 0===t&&(t="0"),(t=n(t))<=0)return e;t>1&&(t=1);for(var i=e.canvas,r=i.height,c=i.width,a=e.getImageData(0,0,c,r),o=a.data,l=o.length,s=0;s<l;s+=4)o[s+0]=Math.abs(o[s+0]-255*t),o[s+1]=Math.abs(o[s+1]-255*t),o[s+2]=Math.abs(o[s+2]-255*t);return e.putImageData(a,0,0),e}),t.set(e.Opacity,function(e,t){if(void 0===t&&(t="1"),(t=n(t))<0)return e;t>1&&(t=1);for(var o=e.canvas,r=o.height,c=o.width,i=e.getImageData(0,0,c,r),a=i.data,l=a.length,s=3;s<l;s+=4)a[s]*=t;return e.putImageData(i,0,0),e}),t.set(e.Saturate,function(e,t){if(void 0===t&&(t="1"),s=n(t),1===s)return e;s<0&&(s=0);for(var s,a,g,b=e.canvas,v=b.height,d=b.width,p=e.getImageData(0,0,d,v),o=p.data,c=.3086*(1-s),l=.6094*(1-s),r=.082*(1-s),j=d<<2,u=0;u<v;u++)for(g=u*j,a=0;a<d;a++){var i=g+(a<<2),h=o[i+0],m=o[i+1],f=o[i+2];o[i+0]=(c+s)*h+l*m+r*f,o[i+1]=c*h+(l+s)*m+r*f,o[i+2]=c*h+l*m+(r+s)*f}return e.putImageData(p,0,0),e}),t.set(e.Sepia,function(e,t){if(void 0===t&&(t="0"),(t=n(t))<=0)return e;t>1&&(t=1);for(var c=e.canvas,d=c.height,u=c.width,l=e.getImageData(0,0,u,d),o=l.data,h=o.length,s=0;s<h;s+=4){var i=o[s+0],a=o[s+1],r=o[s+2];o[s+0]=(.393*i+.769*a+.189*r)*t+i*(1-t),o[s+1]=(.349*i+.686*a+.168*r)*t+a*(1-t),o[s+2]=(.272*i+.534*a+.131*r)*t+r*(1-t)}return e.putImageData(l,0,0),e}),"filter"in CanvasRenderingContext2D.prototype||(i=HTMLCanvasElement,r=CanvasRenderingContext2D,Object.defineProperty(i.prototype,"__skipFilterPatch",{writable:!0,value:!1}),Object.defineProperty(i.prototype,"__currentPathMirror",{writable:!0,value:void 0}),Object.defineProperty(r.prototype,"filter",{writable:!0,value:e.None}),function(e){Object.keys(e.prototype).filter(function(e){return a.indexOf(e)<0}).map(function(t){return{member:t,descriptor:Object.getOwnPropertyDescriptor(e.prototype,t)}}).filter(function(e){return e.descriptor.set}).forEach(function(t){var n=t.member,s=t.descriptor;Object.defineProperty(e.prototype,n,{get:function(){return this.canvas.__skipFilterPatch?s.get.call(this):this.canvas.__currentPathMirror[n]},set:function(e){if(this.canvas.__skipFilterPatch)return s.set.call(this,e);this.canvas.__currentPathMirror||(this.canvas.__currentPathMirror=o(this)),this.canvas.__currentPathMirror[n]=e}})})}(CanvasRenderingContext2D),function(e){Object.keys(e.prototype).filter(function(e){return a.indexOf(e)<0}).map(function(t){return{member:t,descriptor:Object.getOwnPropertyDescriptor(e.prototype,t)}}).filter(function(e){var t=e.descriptor;return t.value&&"function"==typeof t.value}).forEach(function(t){var n=t.member,s=t.descriptor.value;Object.defineProperty(e.prototype,n,{value:function(){for(var t,a,r,i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return this.canvas.__skipFilterPatch?s.call.apply(s,[this].concat(i)):(this.canvas.__currentPathMirror||(this.canvas.__currentPathMirror=o(this)),r=(a=this.canvas.__currentPathMirror)[n].apply(a,i),c.indexOf(n)>-1&&(l(this.canvas.__currentPathMirror,this.filter),this.canvas.__skipFilterPatch=!0,t=void 0,"getTransform"in this&&(t=this.getTransform(),this.setTransform(1,0,0,1,0,0)),this.drawImage(this.canvas.__currentPathMirror.canvas,0,0),t&&this.setTransform(t),this.canvas.__skipFilterPatch=!1,this.canvas.__currentPathMirror=o(this)),r)}})})}(CanvasRenderingContext2D))}()