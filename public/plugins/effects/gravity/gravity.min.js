function Vector(e,t){this.x=e||0,this.y=t||0}function GravityPoint(e,t,n,s){Vector.call(this,e,t),this.radius=n,this.currentRadius=.5*n,this._targets={particles:s.particles||[],gravities:s.gravities||[]},this._speed=new Vector}function Particle(e,t,n){Vector.call(this,e,t),this.radius=n,this._latest=new Vector,this._speed=new Vector}window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},Vector.add=function(e,t){return new Vector(e.x+t.x,e.y+t.y)},Vector.sub=function(e,t){return new Vector(e.x-t.x,e.y-t.y)},Vector.scale=function(e,t){return e.clone().scale(t)},Vector.random=function(){return new Vector(2*Math.random()-1,2*Math.random()-1)},Vector.prototype={set:function(e,t){return"object"==typeof e&&(t=e.y,e=e.x),this.x=e||0,this.y=t||0,this},add:function(e){return this.x+=e.x,this.y+=e.y,this},sub:function(e){return this.x-=e.x,this.y-=e.y,this},scale:function(e){return this.x*=e,this.y*=e,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSq:function(){return this.x*this.x+this.y*this.y},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);return e&&(this.x/=e,this.y/=e),this},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){var t=e.x-this.x,n=e.y-this.y;return Math.atan2(n,t)},distanceTo:function(e){var t=e.x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)},distanceToSq:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},clone:function(){return new Vector(this.x,this.y)},toString:function(){return"(x:"+this.x+", y:"+this.y+")"}},GravityPoint.RADIUS_LIMIT=65,GravityPoint.interferenceToPoint=!0,GravityPoint.prototype=function(e){var t,n=new Vector(0,0);for(t in e)n[t]=e[t];return n}({gravity:.05,isMouseOver:!1,dragging:!1,destroyed:!1,_easeRadius:0,_dragDistance:null,_collapsing:!1,hitTest:function(e){return this.distanceTo(e)<this.radius},startDrag:function(e){this._dragDistance=Vector.sub(e,this),this.dragging=!0},drag:function(e){this.x=e.x-this._dragDistance.x,this.y=e.y-this._dragDistance.y},endDrag:function(){this._dragDistance=null,this.dragging=!1},addSpeed:function(e){this._speed=this._speed.add(e)},collapse:function(){this.currentRadius*=1.75,this._collapsing=!0},render:function(e){if(!this.destroyed){o=this._targets.particles;for(n=0,s=o.length;n<s;n++)o[n].addSpeed(Vector.sub(this,o[n]).normalize().scale(this.gravity));if(this._easeRadius=.95*(this._easeRadius+.07*(this.radius-this.currentRadius)),this.currentRadius+=this._easeRadius,this.currentRadius<0&&(this.currentRadius=0),this._collapsing)return this.radius*=.75,this.currentRadius<1&&(this.destroyed=!0),void this._draw(e);var t,n,s,o,i,a,r=this._targets.gravities,c=this.radius*this.radius*Math.PI;for(n=0,s=r.length;n<s;n++)(t=r[n])===this||t.destroyed||((this.currentRadius>=t.radius||this.dragging)&&this.distanceTo(t)<.85*(this.currentRadius+t.radius)&&(t.destroyed=!0,this.gravity+=t.gravity,a=Vector.sub(t,this).scale(t.radius/this.radius*.5),this.addSpeed(a),i=t.radius*t.radius*Math.PI,this.currentRadius=Math.sqrt((c+3*i)/Math.PI),this.radius=Math.sqrt((c+i)/Math.PI)),t.addSpeed(Vector.sub(this,t).normalize().scale(this.gravity)));GravityPoint.interferenceToPoint&&!this.dragging&&this.add(this._speed),this._speed=new Vector,this.currentRadius>GravityPoint.RADIUS_LIMIT&&this.collapse(),this._draw(e)}},_draw:function(e){var t,n;e.save(),(t=e.createRadialGradient(this.x,this.y,this.radius,this.x,this.y,5*this.radius)).addColorStop(0,"rgba(0, 0, 0, 0.0)"),t.addColorStop(1,"rgba(0, 0, 0, 0.0)"),e.beginPath(),e.arc(this.x,this.y,5*this.radius,0,2*Math.PI,!1),e.fillStyle=t,e.fill(),n=Math.random()*this.currentRadius*.7+.3*this.currentRadius,(t=e.createRadialGradient(this.x,this.y,n,this.x,this.y,this.currentRadius)).addColorStop(0,pointBackgroundColor),t.addColorStop(1,(Math.random(),pointColor)),e.beginPath(),e.arc(this.x,this.y,this.currentRadius,0,2*Math.PI,!1),e.fillStyle=t,e.fill(),e.restore()}}),Particle.prototype=function(e){var t,n=new Vector(0,0);for(t in e)n[t]=e[t];return n}({addSpeed:function(e){this._speed.add(e)},update:function(){this._speed.length()>12&&this._speed.normalize().scale(12),this._latest.set(this),this.add(this._speed)}}),function(){var e,n,s,o,i,r,d,u,h,f=backgroundColor,a=particleSize,p=pointSize,l=new Vector,t=[],c=[];function m(){o=n.width=window.innerWidth,i=n.height=window.innerHeight,r.width=o,r.height=i,s=n.getContext("2d"),e=r.getContext("2d");var a=.5*n.width,c=.5*n.height;(d=s.createRadialGradient(a,c,0,a,c,Math.sqrt(a*a+c*c))).addColorStop(0,"rgba(0, 0, 0, 0)"),d.addColorStop(1,"rgba(0, 0, 0, 0.35)")}h={particleNum:50},n=document.getElementById("gravity"),r=document.createElement("canvas"),window.addEventListener("resize",m,!1),m(),function(e){var t,n;for(t=0;t<e;t++)(n=new Particle(Math.floor(Math.random()*o-2*a)+1+a,Math.floor(Math.random()*i-2*a)+1+a,a)).addSpeed(Vector.random()),c.push(n)}(h.particleNum),n.addEventListener("mousemove",function(e){l.set(e.clientX,e.clientY);var s,o,i=!1;for(o=t.length-1;o>=0;o--)s=t[o],!i&&s.hitTest(l)||s.dragging?s.isMouseOver=i=!0:s.isMouseOver=!1;n.style.cursor=i?"pointer":"default"},!1),n.addEventListener("mousedown",function(e){for(var n=t.length-1;n>=0;n--)if(t[n].isMouseOver)return void t[n].startDrag(l);t.push(new GravityPoint(e.clientX,e.clientY,p,{particles:c,gravities:t}))},!1),n.addEventListener("mouseup",function(){for(var n=0,s=t.length;n<s;n++)if(t[n].dragging){t[n].endDrag();break}},!1),n.addEventListener("dblclick",function(){for(var n=t.length-1;n>=0;n--)if(t[n].isMouseOver){t[n].collapse();break}},!1),u=function(){var n,h,m,p;for(s.save(),s.fillStyle=f,s.fillRect(0,0,o,i),s.fillStyle=d,s.fillRect(0,0,o,i),s.restore(),n=0,m=t.length;n<m;n++)(p=t[n]).dragging&&p.drag(l),p.render(s),p.destroyed&&(t.splice(n,1),m--,n--);for(e.save(),e.globalCompositeOperation="destination-out",e.globalAlpha=.35,e.fillRect(0,0,o,i),e.restore(),m=c.length,e.save(),e.fillStyle=e.strokeStyle=particleColor,e.lineCap=e.lineJoin="round",e.lineWidth=2*a,e.beginPath(),n=0;n<m;n++)(h=c[n]).update(),e.moveTo(h.x,h.y),e.lineTo(h._latest.x,h._latest.y);for(e.stroke(),e.beginPath(),n=0;n<m;n++)h=c[n],e.moveTo(h.x,h.y),e.arc(h.x,h.y,h.radius,0,2*Math.PI,!1);e.fill(),e.restore(),s.drawImage(r,0,0),requestAnimationFrame(u)},u()}()