import{BufferAttribute,BufferGeometry,FileLoader,Float32BufferAttribute,Loader,LoaderUtils,Vector3}from"./three.module.js";var STLLoader=function(e){Loader.call(this,e)};STLLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:STLLoader,load:function(e,t,n,s){var o=this,i=new FileLoader(o.manager);i.setPath(o.path),i.setResponseType("arraybuffer"),i.load(e,function(e){try{t(o.parse(e))}catch(e){s&&s(e)}},n,s)},parse:function(e){function n(e){if(t=new DataView(e),i=32/8*3+32/8*3*3+16/8,a=t.getUint32(80,!0),o=80+32/8+a*i,o===t.byteLength)return!0;for(var t,o,i,a,r=[115,111,108,105,100],n=0;n<5;n++)if(s(r,t,n))return!1;return!0}function s(e,t,n){for(var s=0,o=e.length;s<o;s++)if(e[s]!==t.getUint8(n+s,!1))return!1;return!0}function o(e){for(var n,o,i,a,r,c,l,d,u,f,p,g,v,b,j,y,_,w,O,x,C,E,t=new DataView(e),m=t.getUint32(80,!0),h=!1,s=0;s<80-10;s++)t.getUint32(s,!1)==1129270351&&t.getUint8(s+4)==82&&t.getUint8(s+5)==61&&(h=!0,u=new Float32Array(m*3*3),v=t.getUint8(s+6)/255,g=t.getUint8(s+7)/255,p=t.getUint8(s+8)/255,b=t.getUint8(s+9)/255);E=84,C=12*4+2,o=new BufferGeometry,d=new Float32Array(m*3*3),l=new Float32Array(m*3*3);for(c=0;c<m;c++){i=E+c*C,y=t.getFloat32(i,!0),_=t.getFloat32(i+4,!0),w=t.getFloat32(i+8,!0),h&&(r=t.getUint16(i+48,!0),(r&32768)===0?(x=(r&31)/31,O=(r>>5&31)/31,j=(r>>10&31)/31):(x=v,O=g,j=p));for(a=1;a<=3;a++)f=i+a*12,n=c*3*3+(a-1)*3,d[n]=t.getFloat32(f,!0),d[n+1]=t.getFloat32(f+4,!0),d[n+2]=t.getFloat32(f+8,!0),l[n]=y,l[n+1]=_,l[n+2]=w,h&&(u[n]=x,u[n+1]=O,u[n+2]=j)}return o.setAttribute("position",new BufferAttribute(d,3)),o.setAttribute("normal",new BufferAttribute(l,3)),h&&(o.setAttribute("color",new BufferAttribute(u,3)),o.hasColors=!0,o.alpha=b),o}function i(e){for(var t,i,r,c,m,p,g,o=new BufferGeometry,j=/solid([\s\S]*?)endsolid/g,b=/facet([\s\S]*?)endfacet/g,d=0,n=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,v=new RegExp("vertex"+n+n+n,"g"),y=new RegExp("normal"+n+n+n,"g"),f=[],h=[],s=new Vector3,u=0,a=0,l=0;(t=j.exec(e))!==null;){for(a=l,m=t[0];(t=b.exec(m))!==null;){for(i=0,c=0,r=t[0];(t=y.exec(r))!==null;)s.x=parseFloat(t[1]),s.y=parseFloat(t[2]),s.z=parseFloat(t[3]),c++;for(;(t=v.exec(r))!==null;)f.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),h.push(s.x,s.y,s.z),i++,l++;c!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+d),i!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+d),d++}p=a,g=l-a,o.addGroup(p,g,u),u++}return o.setAttribute("position",new Float32BufferAttribute(f,3)),o.setAttribute("normal",new Float32BufferAttribute(h,3)),o}function a(e){return typeof e!="string"?LoaderUtils.decodeText(new Uint8Array(e)):e}function r(e){if(typeof e=="string"){for(var n=new Uint8Array(e.length),t=0;t<e.length;t++)n[t]=e.charCodeAt(t)&255;return n.buffer||n}return e}var t=r(e);return n(t)?o(t):i(a(e))}});export{STLLoader}